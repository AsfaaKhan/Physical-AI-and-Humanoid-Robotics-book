openapi: 3.0.3
info:
  title: Physical AI & Humanoid Robotics Book RAG API
  description: API for the RAG (Retrieval-Augmented Generation) system integrated with the Physical AI & Humanoid Robotics book
  version: 1.0.0
  contact:
    name: Book Development Team
    email: dev@physical-ai-book.com

servers:
  - url: https://api.physical-ai-book.com
    description: Production server
  - url: https://staging-api.physical-ai-book.com
    description: Staging server
  - url: http://localhost:8000
    description: Development server

paths:
  /chat:
    post:
      summary: Process a user query against the book content
      description: Takes a user question and returns a response based on the book content with proper citations
      operationId: chat
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequest'
            example:
              query: "What are the key components of ROS2?"
              context: "I'm reading about ROS2 architecture"
              session_id: "session-123"
      responses:
        '200':
          description: Successful response with answer and citations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'
              example:
                response: "ROS2 consists of several key components: nodes, topics, services, actions, and parameters. Nodes are processes that perform computation, topics are named buses over which nodes exchange messages, services provide request/response communication, actions are for long-running tasks with feedback, and parameters are configuration values."
                citations:
                  - document_id: "module-1-ros2-basics"
                    section: "Core Concepts"
                    page_reference: "Chapter 1, Section 1.2"
                confidence: 0.95
                query_id: "query-456"
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      tags:
        - Chat
      security:
        - api_key: []

  /search:
    post:
      summary: Search book content for relevant passages
      description: Performs semantic search on the book content to find relevant passages for a given query
      operationId: search
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchRequest'
            example:
              query: "How does Gazebo simulate physics?"
              top_k: 5
      responses:
        '200':
          description: List of relevant passages from the book
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
              example:
                results:
                  - content: "Gazebo uses the ODE (Open Dynamics Engine) physics engine to simulate rigid body dynamics, collisions, and joint constraints. It provides realistic simulation of physical interactions in robotics applications."
                    document_id: "module-2-gazebo-physics"
                    section: "Physics Simulation"
                    score: 0.87
                  - content: "The physics engine in Gazebo handles collision detection, contact forces, and integrates the equations of motion to simulate realistic movement of robots and objects."
                    document_id: "module-2-gazebo-basics"
                    section: "Core Mechanics"
                    score: 0.78
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      tags:
        - Search
      security:
        - api_key: []

  /health:
    get:
      summary: Check API health status
      description: Returns the health status of the RAG API service
      operationId: health
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                status: "healthy"
                timestamp: "2025-12-06T10:30:00Z"
                version: "1.0.0"
        '503':
          description: API is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
      tags:
        - Health

  /documents:
    get:
      summary: List available book documents
      description: Returns a list of all book documents available for querying
      operationId: listDocuments
      responses:
        '200':
          description: List of available documents
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentsResponse'
              example:
                documents:
                  - id: "intro-fundamentals"
                    title: "Introduction to Physical AI Fundamentals"
                    module: "intro"
                    word_count: 5420
                    last_modified: "2025-12-01T15:30:00Z"
                  - id: "module-1-ros2-basics"
                    title: "ROS2 Basics"
                    module: "module-1-ros2"
                    word_count: 7830
                    last_modified: "2025-12-02T14:20:00Z"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      tags:
        - Documents
      security:
        - api_key: []

  /documents/{document_id}:
    get:
      summary: Get details about a specific document
      description: Returns detailed information about a specific book document
      operationId: getDocument
      parameters:
        - name: document_id
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier of the document
      responses:
        '200':
          description: Document details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentDetailResponse'
        '404':
          description: Document not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      tags:
        - Documents
      security:
        - api_key: []

components:
  schemas:
    ChatRequest:
      type: object
      required:
        - query
        - session_id
      properties:
        query:
          type: string
          description: The user's question
          example: "What are the key components of ROS2?"
        context:
          type: string
          description: Optional context from highlighted text or current section
          example: "I'm reading about ROS2 architecture"
        session_id:
          type: string
          description: Unique identifier for the chat session
          example: "session-123"
        user_id:
          type: string
          description: Optional user identifier for analytics
          example: "user-456"

    ChatResponse:
      type: object
      required:
        - response
        - citations
        - confidence
        - query_id
      properties:
        response:
          type: string
          description: The AI-generated response to the query
          example: "ROS2 consists of several key components: nodes, topics, services, actions, and parameters..."
        citations:
          type: array
          description: List of citations to book sections used in the response
          items:
            $ref: '#/components/schemas/Citation'
        confidence:
          type: number
          format: float
          description: Confidence score for the response (0-1)
          minimum: 0
          maximum: 1
          example: 0.95
        query_id:
          type: string
          description: Unique identifier for the query
          example: "query-456"
        was_fallback:
          type: boolean
          description: Whether this was a fallback response (not found in book)
          default: false

    SearchRequest:
      type: object
      required:
        - query
      properties:
        query:
          type: string
          description: The search query
          example: "How does Gazebo simulate physics?"
        top_k:
          type: integer
          description: Number of results to return (default 5)
          minimum: 1
          maximum: 20
          default: 5
          example: 5

    SearchResponse:
      type: object
      required:
        - results
      properties:
        results:
          type: array
          items:
            $ref: '#/components/schemas/SearchResult'

    SearchResult:
      type: object
      required:
        - content
        - document_id
        - section
        - score
      properties:
        content:
          type: string
          description: The relevant content passage
          example: "Gazebo uses the ODE (Open Dynamics Engine) physics engine to simulate rigid body dynamics..."
        document_id:
          type: string
          description: ID of the source document
          example: "module-2-gazebo-physics"
        section:
          type: string
          description: Section title within the document
          example: "Physics Simulation"
        score:
          type: number
          format: float
          description: Relevance score (0-1)
          minimum: 0
          maximum: 1
          example: 0.87

    Citation:
      type: object
      required:
        - document_id
        - section
        - page_reference
      properties:
        document_id:
          type: string
          description: ID of the cited document
          example: "module-1-ros2-basics"
        section:
          type: string
          description: Section title within the document
          example: "Core Concepts"
        page_reference:
          type: string
          description: Page reference in the book
          example: "Chapter 1, Section 1.2"
        url:
          type: string
          description: Optional URL to the specific section
          format: uri
          example: "/docs/module-1-ros2/ros2-basics#core-concepts"

    HealthResponse:
      type: object
      required:
        - status
        - timestamp
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
          example: "healthy"
        timestamp:
          type: string
          format: date-time
          example: "2025-12-06T10:30:00Z"
        version:
          type: string
          example: "1.0.0"
        details:
          type: object
          description: Optional details about service status
          additionalProperties: true

    DocumentsResponse:
      type: object
      required:
        - documents
      properties:
        documents:
          type: array
          items:
            $ref: '#/components/schemas/DocumentSummary'

    DocumentSummary:
      type: object
      required:
        - id
        - title
        - module
        - word_count
        - last_modified
      properties:
        id:
          type: string
          description: Unique document identifier
          example: "module-1-ros2-basics"
        title:
          type: string
          description: Document title
          example: "ROS2 Basics"
        module:
          type: string
          description: Module identifier
          example: "module-1-ros2"
        word_count:
          type: integer
          description: Number of words in the document
          example: 7830
        last_modified:
          type: string
          format: date-time
          description: When the document was last modified
          example: "2025-12-02T14:20:00Z"

    DocumentDetailResponse:
      type: object
      allOf:
        - $ref: '#/components/schemas/DocumentSummary'
        - type: object
          properties:
            content_preview:
              type: string
              description: Preview of the document content
              example: "This chapter covers the fundamentals of ROS2, the Robot Operating System version 2..."
            tags:
              type: array
              description: Tags associated with the document
              items:
                type: string
              example: ["ros2", "architecture", "nodes", "topics"]
            references:
              type: array
              description: Citations used in the document
              items:
                type: string
              example: ["Russell & Norvig, 2020", "ROS.org Documentation, 2024"]

    ErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Error code
          example: "QUERY_TOO_LONG"
        message:
          type: string
          description: Human-readable error message
          example: "Query exceeds maximum length of 1000 characters"
        details:
          type: object
          description: Optional additional error details
          additionalProperties: true

  securitySchemes:
    api_key:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication

tags:
  - name: Chat
    description: Chat and question-answering endpoints
  - name: Search
    description: Semantic search functionality
  - name: Documents
    description: Document management and metadata
  - name: Health
    description: Health check endpoints

security:
  - api_key: []